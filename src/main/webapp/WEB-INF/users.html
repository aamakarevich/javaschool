<div class="container" id="users">

    <h1>Customers</h1>
    <div class="form-group">
        <div class="row">
            <div class="col-lg-9">
                <div class="input-group">
                    <span class="input-group-addon">Filter</span>
                    <input type="text" class="form-control" id="users_filter" onkeyup="filter()">
                    <span class="input-group-btn"><button class="btn btn-default" type="button" onclick="resetFilter()">Reset</button></span>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="btn-group pull-right">
                    <button type="button" id="paging_change" class="btn btn-default dropdown-toggle"
                            data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">Show 5 elements on page <span
                            class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a href="#" onclick="changeElementsCount(5)">5</a></li>
                        <li><a href="#" onclick="changeElementsCount(10)">10</a></li>
                        <li><a href="#" onclick="changeElementsCount(20)">20</a></li>
                        <li><a href="#" onclick="changeElementsCount('all')">All</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div id="users_table_cover" hidden="hidden">
        <div id="users_table"></div>
    </div>

    <nav class="text-center">
        <ul class="pagination" id="pagination"></ul>
        <input type="hidden" id="items_count" value="5"/>
        <input type="hidden" id="current_page" value="1"/>
    </nav>

    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script src="js/jquery.rest.min.js" type="text/javascript"></script>
    <script>
        //    var content2 = link.import.querySelector('#loginModal');
        //    document.querySelector('#molog').appendChild(content2.cloneNode(true));

        var client = new $.RestClient('rest/');

        client.add('login', {
            stripTrailingSlash: true,
            ajax: {async: true}
        });
        client.add('customer', {
            stripTrailingSlash: true,
            ajax: {async: true}
        });

        /*$(document).ready(function () {
            createPagination();
            $("#users_filter").keyup();
        })*/

        function filter() {
            //split the current value of searchInput
            var data = $("#users_filter").val().split(" ");
            //create a jquery object of the rows
            var jo = $("#users_table").find(".panel");
            if (this.value == "") {
                jo.show();
                return;
            }
            //hide all the rows //($t.text().toUpperCase().indexOf(data[d]) > -1)
            jo.hide();

            //Recusively filter the jquery object to get results.
            jo.filter(function (i, v) {
                var $t = $(this);
                for (var d = 0; d < data.length; ++d) {
                    if ($t.text().toUpperCase().indexOf(data[d].toUpperCase()) > -1) {
                        return true;
                    }
                }
                return false;
            })
            //show the rows that match.
                    .show();

        }

        function changePage(value) {
            $("#current_page").val(value);
            $("#users_filter").val("");
            createPagination();
        }

        function changeElementsCount(value) {
            if ($("#items_count").val == value) return;
            if (value == "all") {
                $("#items_count").val(1000000);
                $("#paging_change").html("Show all elements on page <span class=\"caret\">");
            } else {
                $("#items_count").val(value);
                $("#paging_change").html("Show " + value + " elements on page <span class=\"caret\">");
            }
            createPagination();
        }

        function createPagination() {
            client.customer.read("?count").done(function (count) {
                $("#pagination").empty();
                var itemsCount = +$("#items_count").val();
                if (count < itemsCount) {
                    getPagedCustomers();
                    return;
                }

                var total = Math.floor(count / itemsCount);
                if (count > total * itemsCount) total++;

                var current = +$("#current_page").val();
                if (current > total) {
                    current = 1;
                    $("#current_page").val(1);
                }

                var pages = "<li id=\"pag_1\"><a href=\"#\" onclick=\"changePage(1);\">1 <span class=\"sr-only\"></span></a></li>";
                if (current > 5) {
                    pages += "<li><a href=\"#\">... <span class=\"sr-only\"></span></a></li>";
                    for (p = current - 2; p <= current + 2 && p < total; p++) {
                        pages += "<li id=\"pag_" + p + "\"><a href=\"#\" onclick=\"changePage(" + p + ");\">" + p + " <span class=\"sr-only\"></span></a></li>";
                    }
                } else {
                    for (p = 2; p <= 7 && p < total; p++) {
                        pages += "<li id=\"pag_" + p + "\"><a href=\"#\" onclick=\"changePage(" + p + ");\">" + p + " <span class=\"sr-only\"></span></a></li>";
                    }
                }
                if (total - current > 5) {
                    pages += "<li><a href=\"#\">... <span class=\"sr-only\"></span></a></li>";
                }
                pages += "<li id=\"pag_" + total + "\"><a href=\"#\" onclick=\"changePage(" + total + ");\">" + total + " <span class=\"sr-only\"></span></a></li>";
                //pages += "<li id=\"pag_next\"><a href=\"#\" aria-label=\"Next\"><span aria-hidden=\"true\">&raquo;</span></a></li>";
                $("#pagination").append(pages);

                getPagedCustomers();
            });
        }

        function getPagedCustomers() {

            client.customer.read("?page=" + $("#current_page").val() + "&size=" + $("#items_count").val()).done(function (customers) {

                var customersRows = "";
                for (var c in customers) {
                    customersRows += "<div class=\"panel panel-default\">" +
                            "<div class=\"panel-heading\">" +
                            "<h3 class=\"panel-title text-uppercase\"><strong>" + customers[c].lastName + " " + customers[c].firstName + "</strong> / " + customers[c].email + "</h3>" +
                            "<div class=\"btn-group pull-right\"><a href=\"#\" class=\"btn btn-default btn-sm\">Edit customer info</a>" +
                            "<a href=\"#\" class=\"btn btn-default btn-sm\">Delete customer</a></div>" +
                            "</div>" +
                            "<div class=\"panel-body\">" +
                            "<strong>BIRTHDATE</strong>: " + customers[c].birthdate + "<br />" +
                            "<strong>ADDRESS</strong>: " + customers[c].address.city + ", " + customers[c].address.address1 + " " + customers[c].address.address2 +
                            "</div></div>"
                }

                $("#users_table").empty();
                $("#users_table").append(customersRows);

                $("#pagination li").removeClass("active");
                if ($("#current_page").val() == 1) $("#pag_prev").addClass("disabled");
                $("#pag_" + $("#current_page").val()).addClass("active");
            });
            $("#users_table_cover").fadeIn(1500);
        }

        function resetFilter() {
            $("#users_filter").val("");
            $("#users_filter").keyup();
        }
    </script>

</div>